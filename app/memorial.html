<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>çºªå¿µé¦† â€” å½©è™¹æ¡¥</title>
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/core.css">
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/memorial.css">
</head>
<body>

<div class="grain"></div>
<div class="page-transition active"></div>
<div class="cursor-dot" id="cDot"></div>
<div class="cursor-ring" id="cRing"></div>

<!-- èƒŒæ™¯æ˜Ÿæ˜Ÿ (CSS) -->
<div class="bg-stars" id="bgStars"></div>

<nav class="nav">
  <a href="index.html" class="nav-logo" data-hover onclick="event.preventDefault();navigateTo(this.href)">å½©è™¹<span>æ¡¥</span></a>
  <ul class="nav-links">
    <li><a href="index.html" data-hover onclick="event.preventDefault();navigateTo(this.href)">æ˜Ÿ ç©º</a></li>
    <li><a href="create.html" data-hover onclick="event.preventDefault();navigateTo(this.href)">çºª å¿µ</a></li>
    <li><a href="about.html" data-hover onclick="event.preventDefault();navigateTo(this.href)">å…³ äº</a></li>
  </ul>
  <div class="nav-burger" aria-label="èœå•">
    <span></span><span></span><span></span>
  </div>
</nav>

<div class="nav-mobile">
  <a href="index.html">æ˜Ÿ ç©º</a>
  <a href="create.html">çºª å¿µ</a>
  <a href="about.html">å…³ äº</a>
</div>

<div class="mem-container">
  <a href="index.html" class="back-link" data-hover onclick="event.preventDefault();navigateTo(this.href)">â† å›åˆ°æ˜Ÿç©º</a>

  <!-- å¤´éƒ¨ -->
  <header class="mem-header reveal-blur" id="memHeader">
    <div class="mem-avatar" id="memAvatar">ğŸ±</div>
    <h1 class="mem-name" id="memName"></h1>
    <p class="mem-dates" id="memDates"></p>
    <p class="mem-duration" id="memDuration"></p>
  </header>

  <!-- åˆ†éš”çº¿ -->
  <div class="gold-line reveal-blur"></div>

  <!-- èœ¡çƒ› -->
  <div class="candle-section reveal-blur">
    <div class="candle-row">
      <div class="candle"><div class="flame-glow"></div><div class="flame"></div></div>
      <div class="candle"><div class="flame-glow"></div><div class="flame"></div></div>
      <div class="candle"><div class="flame-glow"></div><div class="flame"></div></div>
    </div>
    <div class="candle-info">
      <div class="candle-num" id="candleNum">0</div>
      <div class="candle-label">äººç‚¹äº®äº†èœ¡çƒ›</div>
    </div>
    <button class="btn candle-btn" id="candleBtn" data-hover>ç‚¹äº®ä¸€æ”¯èœ¡çƒ›</button>
  </div>

  <!-- å¯„è¯­ -->
  <div class="section reveal-blur" id="msgSection">
    <div class="section-label">å¯„ è¯­</div>
    <div class="msg-text" id="msgText"></div>
  </div>

  <!-- çºªå¿µè¯— -->
  <div class="section reveal-blur" id="poemSection" style="display:none">
    <div class="section-label">çºª å¿µ è¯—</div>
    <div class="poem-text" id="poemText"></div>
  </div>

  <!-- ç•™è¨€å¢™ -->
  <div class="section reveal-blur">
    <div class="section-label">ç•™ è¨€ å¢™</div>
    <div id="wallList" class="wall-list"></div>
    <div class="wall-form">
      <textarea id="wallInput" class="form-textarea" rows="2" placeholder="å†™ä¸‹ä½ æƒ³è¯´çš„è¯..."></textarea>
      <button class="btn wall-btn" id="wallBtn" data-hover>å‘é€</button>
    </div>
  </div>

  <!-- åˆ†äº« -->
  <div class="share-row reveal-blur">
    <a class="share-btn" id="shareLink" data-hover>å¤åˆ¶é“¾æ¥</a>
  </div>

  <!-- åº•éƒ¨ -->
  <footer class="mem-footer reveal-blur">
    <p>"ä»–ä»¬ä¸æ›¾çœŸæ­£ç¦»å¼€ï¼Œåªæ˜¯æ¢äº†ä¸€ç§æ–¹å¼é™ªä¼´"</p>
    <a href="index.html" data-hover onclick="event.preventDefault();navigateTo(this.href)">å½©è™¹æ¡¥</a>
  </footer>
</div>

<script src="js/data.js"></script>
<script src="js/cursor.js"></script>
<script src="js/nav.js"></script>
<script>
(function() {
  const id = new URLSearchParams(location.search).get('id');
  if (!id) { location.href = 'index.html'; return; }
  RainbowBridge.init();
  const m = RainbowBridge.getById(id);
  if (!m) { location.href = 'index.html'; return; }

  // èƒŒæ™¯æ˜Ÿ
  const bg = document.getElementById('bgStars');
  for (let i = 0; i < 60; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    s.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*100}%;animation-delay:${Math.random()*3}s;animation-duration:${2+Math.random()*2}s;`;
    bg.appendChild(s);
  }

  // å¡«å……
  const avatarMap = { cat:'ğŸ±', dog:'ğŸ•', rabbit:'ğŸ°', hamster:'ğŸ¹', bird:'ğŸ¦', fish:'ğŸŸ', turtle:'ğŸ¢' };
  document.title = `${m.name}çš„çºªå¿µé¦† â€” å½©è™¹æ¡¥`;
  document.getElementById('memAvatar').textContent = avatarMap[m.type] || 'ğŸŒŸ';
  document.getElementById('memName').textContent = m.name;
  document.getElementById('memDates').textContent =
    m.birthDate && m.deathDate ? `${m.birthDate} â€” ${m.deathDate}` :
    m.deathDate ? `å’äº ${m.deathDate}` : '';
  document.getElementById('memDuration').textContent = m.duration ? `âœ¦ é™ªä¼´äº† ${m.duration}` : '';
  document.getElementById('candleNum').textContent = (m.candles||0).toLocaleString();

  const msgEl = document.getElementById('msgText');
  if (m.message) {
    msgEl.innerHTML = m.message.split('\n').map(p => `<p>${p}</p>`).join('');
  } else {
    document.getElementById('msgSection').style.display = 'none';
  }

  if (m.poem) {
    document.getElementById('poemSection').style.display = '';
    document.getElementById('poemText').innerHTML = m.poem.split('\n').join('<br>');
  }

  renderWall();

  // èœ¡çƒ›
  const candleBtn = document.getElementById('candleBtn');
  candleBtn.addEventListener('click', function() {
    const u = RainbowBridge.lightCandle(m.id);
    if (u) document.getElementById('candleNum').textContent = u.candles.toLocaleString();
    this.textContent = 'å·²ç‚¹äº® âœ¦';
    this.classList.add('lit');
    setTimeout(() => {
      this.textContent = 'å†ç‚¹ä¸€æ”¯';
      this.classList.remove('lit');
    }, 1800);
  });

  // ç•™è¨€
  document.getElementById('wallBtn').addEventListener('click', () => {
    const inp = document.getElementById('wallInput');
    const txt = inp.value.trim();
    if (!txt) return;
    RainbowBridge.addMessage(m.id, 'åŒ¿åè®¿å®¢', txt);
    inp.value = '';
    renderWall();
  });

  // åˆ†äº«
  document.getElementById('shareLink').addEventListener('click', () => {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      const el = document.getElementById('shareLink');
      el.textContent = 'å·²å¤åˆ¶ âœ“';
      setTimeout(() => { el.textContent = 'å¤åˆ¶é“¾æ¥'; }, 2000);
    }).catch(() => {});
  });

  function renderWall() {
    const msgs = RainbowBridge.getMessages(m.id);
    const list = document.getElementById('wallList');
    if (!msgs.length) {
      list.innerHTML = '<div class="wall-empty">è¿˜æ²¡æœ‰ç•™è¨€ï¼Œå†™ä¸‹ç¬¬ä¸€æ¡å§</div>';
      return;
    }
    list.innerHTML = msgs.map(msg => `
      <div class="wall-item">
        <div class="wall-author">${esc(msg.author)}</div>
        <div class="wall-content">${esc(msg.content)}</div>
        <div class="wall-time">${msg.time}</div>
      </div>
    `).join('');
  }

  function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

  // æ»šåŠ¨æ­ç¤º
  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { threshold: 0.15 });
  document.querySelectorAll('.reveal-blur').forEach(el => obs.observe(el));
})();
</script>
</body>
</html>
